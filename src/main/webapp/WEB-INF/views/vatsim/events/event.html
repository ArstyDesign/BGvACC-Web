<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{templates/mainTemplate}">
  <head>
    <title th:text="#{app.title(${event.name})}">BGvACC</title>

    <style>
      .eventDescription a {
        color: var(--bs-primary) !important;
      }
    </style>
  </head>
  <body>
    <div layout:fragment="contentDiv">

      <!--Card-->
      <div class="card shadow border-0 mb-4">
        <div class="d-flex flex-lg-row flex-column overflow-hidden ">
          <div class="">
            <!--Image-->
            <img src="#" th:src="${event.imageUrl}" alt="" class="img-fluid border rounded"/>
          </div>
          <div class="card-body h-100 p-0 mt-0 m-4 flex-grow-1">
            <div class="my-4">
              <h1 class="h4 mb-2" th:text="${event.name}">Title</h1>
              <div class="lh-1 text-body-secondary" th:text="${event.getFormattedStartDateTime('dd.MM.yyyy, HH:mm')} + ' - ' + ${event.getFormattedEndDateTime('HH:mm')} + 'z'">Mar 12, 2021</div>
            </div>
            <div class="fs-5" th:text="${event.shortDescription}">Short description</div>
            <hr class="mt-3 mb-0 d-block d-lg-none"/>
          </div>
        </div>
        <div class="eventDescription mx-4 mb-4 mt-0 mt-lg-4">
          <div th:utext="${event.htmlDescription}">Description</div>

          <!--<div th:text="${!session.roles.?[roleName.contains('ATC')].isEmpty()}">test</div>-->

<!--          <div sec:authorize="isAuthenticated()" th:if="${!session.roles.?[roleName.contains('ATC')].isEmpty()}">
            <a href="#" class="btn btn-primary btn-sm mt-3">Apply for controlling</a>
          </div>-->
        </div>
      </div>

      <!--      <div th:text="${eventPositions[0].slots}"></div>-->

      <div class="card">
        <div class="card-body">
          <div class="h5 mb-3">Event roster</div>
          
          <!--<div th:text="${eventPositions}"></div>-->

          <!--<div th:text="${@slotsGenerator.generateSlots(event.startAt.toLocalDateTime(), event.endAt.toLocalDateTime(), mostSlots)}"></div>-->
          
          <div th:if="${!doAllPositionsHaveSlots}" class="text-muted">
            <small class="bi bi-info-circle me-1"></small>
            <small>The event roster is currently being configured. It will soon be available for booking.</small>
          </div>

          <table class="table table-hover table-striped table-bordered" th:if="${doAllPositionsHaveSlots}">
            <thead>
              <tr>
                <th scope="col" class="fw-bold">Position / Slot</th>
                <th scope="col" class="fw-bold text-center" th:each="sl : ${@slotsGenerator.generateSlots(event.startAt.toLocalDateTime(), event.endAt.toLocalDateTime(), mostSlots)}"
                    th:text="${sl.getFormattedStartDateTime('HH:mm')} + ' - ' + ${sl.getFormattedEndDateTime('HH:mm')} + 'z'"></th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="ep : ${eventPositions}">
                <td th:text="#{positions. + ${#strings.toLowerCase(ep.positionId)}}"></td>
                <!--<td th:text="'mostSlots: ' + ${mostSlots} + ', ep.slots.size: ' + ${#lists.size(ep.slots)}"></td>-->

                <td th:colspan="${mostSlots / #lists.size(ep.slots)}" class="text-center"
                    th:each="sl, iterStat : ${ep.slots}">
                  <a href="#" th:if="${!sl.isApproved}" class="btn btn-primary btn-sm">Apply for slot</a>
                  <span th:if="${sl.isApproved}" th:text="${sl.user != null ? sl.user.names.fullName : '-'}"></span>
                </td>

                <!--<td th:if="${#lists.size(ep.slots) eq 0}" class="text-center">-</td>-->

                <!--                 Добавяне на стойности по подразбиране в останалите колони, ако няма достатъчно елементи в ep.slots 
                                <td th:each="i : ${#numbers.sequence(1, mostSlots - #lists.size(ep.slots) + 1)}" class="text-center">
                                  Default
                                </td>-->
              </tr>
            </tbody>
          </table>

          <!--          <div th:each="ep, iterStat : ${eventPositions}" th:remove="tag">
          
                      <table class="table table-hover table-striped" style="table-layout: fixed; width: 100%;">
                        <thead>
                          <tr>
                            <th scope="col" class="fw-bold" th:text="${iterStat.first} ? 'Position'">Position</th>
                            <th scope="col" class="fw-bold text-end text-md-start" th:each="s : ${ep.slots}" th:text="${s.getFormattedStartDateTime('HH:mm')} + ' - ' + ${s.getFormattedEndDateTime('HH:mm')} + 'z'"></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td th:text="#{positions. + ${#strings.toLowerCase(ep.positionId)}}">Position</td>
                            <td th:each="s : ${ep.slots}" th:text="${s.user.names.fullName}">-</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>-->
        </div>
      </div>


      <!--      <div class="card mb-3">
              <div class="row g-0">
                <div class="col-md-5">
                  <img src="#" th:src="${event.banner}" class="img-fluid rounded-start" alt="#" th:alt="${event.name}"/>
                </div>
                <div class="col-md-7">
                  <div class="card-body">
                    <h5 class="card-title" th:text="${event.name}">Card title</h5>
                    <p class="card-text" th:text="${event.description}">Description</p>
                    <div class="row">
                      <dl class="col-12 col-md-6 mb-3">
                        <dt>Start time</dt>
                        <dd th:text="${event.startTimeFormatted}">-</dd>
                      </dl>
                      <dl class="col-12 col-md-6 mb-0 mb-md-3">
                        <dt>End time</dt>
                        <dd th:text="${event.endTimeFormatted}">-</dd>
                      </dl>
                    </div>
                    <p class="card-text"><small class="text-body-secondary">Last updated 3 mins ago</small></p>
                    <div class="">
                      <a href="#" th:href="${event.link}" class="btn btn-primary" target="_blank">Link to event</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>-->
    </div>
  </body>
</html>