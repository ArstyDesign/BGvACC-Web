<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{templates/mainTemplate}">
  <head>
    <title th:text="#{app.title(${event.name})}">BGvACC</title>

    <style>
      .eventDescription a {
        color: var(--bs-primary) !important;
      }
    </style>
  </head>
  <body>
    <div layout:fragment="contentDiv">

      <!--Card-->
      <div class="card shadow border-0 mb-4">
        <div class="d-flex flex-lg-row flex-column overflow-hidden ">
          <div class="">
            <!--Image-->
            <img src="#" th:src="${event.imageUrl}" alt="" class="img-fluid border rounded"/>
          </div>
          <div class="card-body h-100 p-0 mt-0 m-4 flex-grow-1">
            <div class="my-4">
              <h1 class="h4 mb-2" th:text="${event.name}">Title</h1>
              <div class="lh-1 text-body-secondary" th:text="${event.getFormattedStartDateTime('dd.MM.yyyy, HH:mm')} + ' - ' + ${event.getFormattedEndDateTime('HH:mm')} + 'z'">Mar 12, 2021</div>
            </div>
            <div class="fs-5" th:text="${event.shortDescription}">Short description</div>
            <hr class="mt-3 mb-0 d-block d-lg-none"/>
          </div>
        </div>
        <div class="eventDescription mx-4 mb-4 mt-0 mt-lg-4">
          <div th:utext="${event.htmlDescription}">Description</div>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <div class="h5 mb-3">Event roster</div>

          <div th:if="${!doAllPositionsHaveSlots}" class="text-muted">
            <small class="bi bi-info-circle me-1"></small>
            <small>The event roster is currently being configured. It will soon be available for booking.</small>
          </div>

          <table class="table table-hover table-striped table-bordered" th:if="${doAllPositionsHaveSlots}">
            <thead>
              <tr>
                <th scope="col" class="fw-bold">Position / Slot</th>
                <th scope="col" class="fw-bold text-center" th:each="sl : ${@slotsGenerator.generateSlots(event.startAt.toLocalDateTime(), event.endAt.toLocalDateTime(), mostSlots)}"
                    th:text="${sl.getFormattedStartDateTime('HH:mm')} + ' - ' + ${sl.getFormattedEndDateTime('HH:mm')} + 'z'"></th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="ep : ${eventPositions}">
                <td th:text="#{positions. + ${#strings.toLowerCase(ep.positionId)}}"></td>

                <td th:colspan="${mostSlots / #lists.size(ep.slots)}" class="text-center"
                    th:each="sl, iterStat : ${ep.slots}">
                  <div sec:authorize="isAuthenticated()" th:remove="tag">
                    <a href="#" th:if="${!sl.isApproved}" class="btn btn-primary btn-sm">Apply for slot</a>
                    <span th:if="${sl.isApproved}" th:text="${sl.user != null ? sl.user.names.fullName : '-'}"></span>
                  </div>
                  <div sec:authorize="!isAuthenticated()" th:remove="tag">
                    <span th:text="${sl.isApproved} ? sl.user.names.fullName : '-'"></span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
</html>